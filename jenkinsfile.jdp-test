pipeline{
    agent any 
      stages{
        stage('step-1-pull'){
          steps{
            git branch: 'devops', url: 'https://github.com/abhilashmwaghmare/EASY_CRUD.git'
          }
        }

        stage('step-2-build'){
          steps{
            echo 'build success'
            sh '''cd backend 
                 mvn clean package -DskipTests'''
          }
        }

        stage('step-3-test'){
          steps{
            withSonarQubeEnv('sonarqube') {
                sh '''cd backend 
                      mvn sonar:sonar \\
                     -Dsonar.projectKey=studentapp \\
                     -Dsonar.projectName=studentapp'''

                
            }
          }
        }

        stage('Stage-4: Quality Gate') {
            steps {
                timeout(time: 2, unit: 'MINUTES') {
                    waitForQualityGate abortPipeline: true, credentialsId: 'sonar-cred'
                }
            }
        }

        stage('step-5-deploy'){
          steps{
            echo 'deploy success'
          }
        }

        
      }
}
